WITH customer_revenue AS (
    SELECT
        customer_id,
        COUNT(DISTINCT order_id) AS total_orders,           -- Count of distinct orders per customer
        SUM(total_price) AS total_revenue                    -- Total revenue per customer
    FROM {{ ref('stg_sales') }}
    GROUP BY customer_id
)

SELECT
    customer_id,
    total_orders,
    total_revenue
FROM customer_revenue
ORDER BY total_revenue DESC                             -- Order by total revenue in descending order
LIMIT 10